doctype html
html(lang="id" class="scroll-smooth")
  head
    // ... (meta tags, links, etc. - keeping the head the same for now)
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title= title || "KitaNime - Streaming Anime Subtitle Indonesia"
    // ... other meta tags

    link(rel="preconnect" href="https://fonts.googleapis.com")
    link(rel="preconnect" href="https://fonts.gstatic.com" crossorigin)
    link(href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet")

    // ... other links
    link(rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css")
    script(src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js")
    script(src='https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js')
    script(async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7452678962186302" crossorigin="anonymous")
    script(src="https://cdn.tailwindcss.com/3.4.17")
    script.
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              'yt-red': '#FF0000',
              'yt-white': '#FFFFFF',
              'yt-black': '#0F0F0F',
              'yt-light-text': '#030303',
              'yt-dark-text': '#F1F1F1',
              'yt-light-gray-1': '#F1F1F1', // Light backgrounds
              'yt-light-gray-2': '#E5E5E5', // Light borders/hovers
              'yt-dark-gray-1': '#272727',  // Dark UI elements
              'yt-dark-gray-2': '#3F3F3F',  // Dark borders/hovers
              primary: { // Re-mapping primary to shades of red
                500: '#FF0000',
                600: '#E60000',
                700: '#CC0000',
              }
            },
            fontFamily: {
              'sans': ['Roboto', 'system-ui', 'sans-serif']
            }
          }
        }
      }
    
    style.
      :root {
        --sidebar-width-full: 240px;
        --sidebar-width-collapsed: 72px;
      }
      body {
        font-family: 'Roboto', sans-serif;
      }
      #main-content {
        transition: margin-left 0.3s ease;
        margin-left: var(--sidebar-width-full);
      }
      #sidebar {
        width: var(--sidebar-width-full);
        transition: width 0.3s ease;
      }
      body.sidebar-collapsed #main-content {
        margin-left: var(--sidebar-width-collapsed);
      }
      body.sidebar-collapsed #sidebar {
        width: var(--sidebar-width-collapsed);
      }
      body.sidebar-collapsed #sidebar .sidebar-text {
        display: none;
      }
      body.sidebar-collapsed #sidebar .sidebar-link {
        justify-content: center;
      }
      @media (max-width: 768px) {
        #main-content { margin-left: 0; }
        #sidebar { transform: translateX(-100%); width: var(--sidebar-width-full); z-index: 60; }
        body.sidebar-open #sidebar { transform: translateX(0); }
        body.sidebar-open #content-overlay { display: block; }
      }

  body(class="bg-yt-white dark:bg-yt-black text-yt-light-text dark:text-yt-dark-text font-sans transition-colors duration-300")
    // YouTube-style Header
    header(class="bg-yt-white dark:bg-yt-black border-b border-yt-light-gray-2 dark:border-yt-dark-gray-2 sticky top-0 z-50")
      div(class="container mx-auto px-4")
        div(class="flex items-center justify-between h-14")
          // Left Section
          div(class="flex items-center space-x-4")
            button(id="sidebarToggleBtn" class="p-2 rounded-full hover:bg-yt-light-gray-2 dark:hover:bg-yt-dark-gray-1")
              i(data-lucide="menu" class="w-6 h-6")
            a(href="/" class="flex items-center")
              img(src="/images/logo.png" alt="KitaNime" class="h-8 w-auto rounded-sm", onerror="this.onerror=null;this.src='https://placehold.co/400?text=KN';")

          // Center Section
          div(class="flex-1 flex justify-center px-4 lg:px-16")
            div(class="w-full max-w-2xl")
              form(action="/search" method="GET" class="relative flex")
                input(type="text" name="q" placeholder="Cari..." value=keyword || "" class="flex-grow px-4 py-2 pl-4 border border-yt-light-gray-2 dark:border-yt-dark-gray-2 rounded-l-full bg-yt-white dark:bg-yt-black text-yt-light-text dark:text-yt-dark-text focus:ring-2 focus:ring-yt-red focus:border-yt-red")
                button(type="submit" class="flex-shrink-0 px-4 py-2 bg-yt-light-gray-1 hover:bg-yt-light-gray-2 dark:bg-yt-dark-gray-1 dark:hover:bg-yt-dark-gray-2 rounded-r-full border border-yt-light-gray-2 dark:border-yt-dark-gray-2 border-l-0")
                  i(data-lucide="search" class="w-5 h-5")
          // Right Section
          div(class="flex items-center space-x-2")
            button(id="darkModeToggle" class="p-2 rounded-full hover:bg-yt-light-gray-2 dark:hover:bg-yt-dark-gray-1")
              i(data-lucide="sun" class="w-5 h-5 text-yellow-500 dark:hidden")
              i(data-lucide="moon" class="w-5 h-5 text-gray-300 hidden dark:block")
            
            if user
              button(class="hidden md:block p-2 rounded-full hover:bg-yt-light-gray-2 dark:hover:bg-yt-dark-gray-1")
                i(data-lucide="video-plus" class="w-5 h-5")
              button(class="hidden md:block p-2 rounded-full hover:bg-yt-light-gray-2 dark:hover:bg-yt-dark-gray-1")
                i(data-lucide="bell" class="w-5 h-5")
              
              //- User Dropdown (Simplified)
              div(class="relative ml-2")
                button(onclick="toggleUserMenu()" class="flex items-center justify-center h-8 w-8 rounded-full bg-yt-red text-white font-bold")
                  span= user.username.charAt(0).toUpperCase()
                div(id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-yt-white dark:bg-yt-dark-gray-1 rounded-md shadow-lg py-1 z-50")
                  div(class="px-4 py-2 text-sm text-yt-light-text dark:text-yt-dark-text")
                    div Signed in as
                    div(class="font-medium")= user.username
                  hr(class="border-yt-light-gray-2 dark:border-yt-dark-gray-2")
                  a(href="/auth/logout" class="block px-4 py-2 text-sm text-yt-light-text dark:text-yt-dark-text hover:bg-yt-light-gray-2 dark:hover:bg-yt-dark-gray-1") Logout

            else
              a(href="/auth/login" class="flex items-center border border-blue-500 text-blue-500 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-blue-50 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/50")
                i(data-lucide="user-circle" class="w-5 h-5 mr-2")
                span Login


    // Page Container
    div(class="relative")
      // Sidebar
      aside(id="sidebar" class="fixed top-0 left-0 h-full pt-14 bg-yt-white dark:bg-yt-black border-r border-yt-light-gray-2 dark:border-yt-dark-gray-2 flex flex-col transition-transform duration-300")
        div(class="overflow-y-auto overflow-x-hidden flex-grow")
          nav(class="py-4 px-2")
            - const links = [{href: "/", icon: "home", text: "Home"}, {href: "/ongoing", icon: "clock", text: "Ongoing"}, {href: "/complete", icon: "check-circle", text: "Complete"}, {href: "/genres", icon: "tag", text: "Genre"}, {href: "/movies", icon: "film", text: "Movie"}]
            each link in links
              a(href=link.href class=`sidebar-link flex items-center p-3 text-sm rounded-lg hover:bg-yt-light-gray-2 dark:hover:bg-yt-dark-gray-1 ${currentPage === link.text.toLowerCase() ? 'bg-yt-light-gray-2 dark:bg-yt-dark-gray-1 font-semibold' : ''}`)
                i(data-lucide=link.icon class="w-5 h-5 mr-4")
                span(class="sidebar-text")= link.text

            if user
              hr(class="my-3 border-yt-light-gray-2 dark:border-yt-dark-gray-2")
              a(href="/user/bookmarks" class=`sidebar-link flex items-center p-3 text-sm rounded-lg hover:bg-yt-light-gray-2 dark:hover:bg-yt-dark-gray-1 ${currentPage === 'bookmarks' ? 'bg-yt-light-gray-2 dark:bg-yt-dark-gray-1 font-semibold' : ''}`)
                i(data-lucide="bookmark" class="w-5 h-5 mr-4")
                span(class="sidebar-text") Bookmarks
              a(href="/user/history" class=`sidebar-link flex items-center p-3 text-sm rounded-lg hover:bg-yt-light-gray-2 dark:hover:bg-yt-dark-gray-1 ${currentPage === 'history' ? 'bg-yt-light-gray-2 dark:bg-yt-dark-gray-1 font-semibold' : ''}`)
                i(data-lucide="history" class="w-5 h-5 mr-4")
                span(class="sidebar-text") History
              a(href="/user/likes" class=`sidebar-link flex items-center p-3 text-sm rounded-lg hover:bg-yt-light-gray-2 dark:hover:bg-yt-dark-gray-1 ${currentPage === 'likes' ? 'bg-yt-light-gray-2 dark:bg-yt-dark-gray-1 font-semibold' : ''}`)
                i(data-lucide="heart" class="w-5 h-5 mr-4")
                span(class="sidebar-text") Liked Anime

      // Overlay for mobile
      div(id="content-overlay" class="hidden fixed inset-0 bg-black/50 z-50 md:hidden")

      // Main Content
      div(id="main-content")
        main(class="min-h-screen")
          block content

        footer(class="bg-yt-white dark:bg-yt-black border-t border-yt-light-gray-2 dark:border-yt-dark-gray-2 mt-12 py-8")
          div(class="container mx-auto px-4 text-center text-sm text-gray-500")
            p KitaNime &copy; 2025. Desain terinspirasi oleh YouTube.
    
    // Cookie Consent
    // ...

    script(src="https://unpkg.com/lucide@latest")
    script.
      lucide.createIcons();

      // Dark Mode Toggle
      const darkModeToggle = document.getElementById('darkModeToggle');
      const html = document.documentElement;
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        html.classList.add('dark');
      }
      darkModeToggle?.addEventListener('click', function() {
        html.classList.toggle('dark');
        localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
      });

      // Sidebar Toggle
      const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
      const body = document.body;
      const contentOverlay = document.getElementById('content-overlay');

      sidebarToggleBtn?.addEventListener('click', function() {
        if (window.innerWidth < 768) {
          body.classList.toggle('sidebar-open');
        } else {
          body.classList.toggle('sidebar-collapsed');
        }
      });
      
      contentOverlay?.addEventListener('click', function() {
        body.classList.remove('sidebar-open');
      });
      
      // User Menu Toggle
      function toggleUserMenu() {
        const menu = document.getElementById('userMenu');
        if (menu) {
          menu.classList.toggle('hidden');
        }
      }
      
      // Close user menu if clicking outside
      window.addEventListener('click', function(e) {
        const menu = document.getElementById('userMenu');
        const userMenuButton = e.target.closest('button[onclick="toggleUserMenu()"]');
        
        if (menu && !menu.classList.contains('hidden') && !userMenuButton) {
          menu.classList.add('hidden');
        }
      });
      
  block scripts
