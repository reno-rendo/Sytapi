extends layout

block content
  // Main Content Grid
  div(class="container mx-auto px-4 py-6")
    - const allAnime = (ongoingAnime || []).concat(completeAnime || [])

    //- Iron-selector style category bar
    if genres && genres.length > 0
      div(class="relative mb-6")
        div(id="genre-scroller-container" class="flex items-center")
          button(id="scroll-left" class="absolute left-0 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-black/80 backdrop-blur-sm p-1 rounded-full shadow-md z-10 hidden")
            i(data-lucide="chevron-left" class="w-6 h-6")
          
          div(id="genre-chips-container" class="flex items-center space-x-3 overflow-x-auto scrollbar-hide py-2")
            button(data-genre-slug="all" class="genre-chip active-chip flex-shrink-0 px-4 py-2 text-sm font-semibold rounded-lg bg-yt-light-text text-yt-white dark:bg-yt-dark-text dark:text-yt-black") Semua
            each genre in genres
              button(data-genre-slug=genre.slug class="genre-chip flex-shrink-0 px-4 py-2 text-sm font-semibold rounded-lg bg-yt-light-gray-2 dark:bg-yt-dark-gray-1 hover:bg-gray-300 dark:hover:bg-yt-dark-gray-2")= genre.name

          button(id="scroll-right" class="absolute right-0 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-black/80 backdrop-blur-sm p-1 rounded-full shadow-md z-10")
            i(data-lucide="chevron-right" class="w-6 h-6")

    if allAnime.length > 0
      // Flexbox-based Responsive Grid
      div(id="anime-grid" class="flex flex-wrap justify-center gap-3")
        each anime in allAnime
          - const animeGenres = anime.genres ? JSON.stringify(anime.genres.map(g => g.slug)) : '[]'
          a(href=`/anime/${anime.slug}` class="anime-card group w-[172px]" data-genres=animeGenres)
            div(class="flex flex-col")
              // Thumbnail
              div(class="relative mb-2")
                img(src=anime.poster alt=anime.title width="172" height="256" class="object-cover rounded-lg bg-gray-200 dark:bg-gray-700" onerror="this.onerror=null;this.src='https://placehold.co/172x256?text=No+Image';")
                // New combined badge
                - let badgeTextContent = anime.newest_release_date || '';
                if anime.current_episode
                  - badgeTextContent += (badgeTextContent ?  ' • ' : '') + ` ${anime.current_episode}` ;
                else if anime.status === 'Completed'
                  - badgeTextContent += (badgeTextContent ? ' • ' : '') + `Complete`;
                if anime.rating && !anime.current_episode && anime.status !== 'Completed'
                  - badgeTextContent += (badgeTextContent ? ' • ' : '') + `⭐ ${anime.rating}`; // Using a star emoji for simplicity if icon is hard

                if badgeTextContent
                  span(class="absolute bottom-1 right-1 bg-black/80 text-white text-xs font-semibold px-1.5 py-0.5 rounded flex items-center")
                    | #{badgeTextContent}

              // Video Details
              div(class="flex items-start")
                div(class="flex-1")
                  h3(class="text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2 leading-tight group-hover:text-yt-red")= anime.title
                  div(class="text-xs text-gray-600 dark:text-gray-400 mt-1")
                    p(class="line-clamp-1")
                      | #{anime.release_day || 'Complated'}
                      if anime.current_episode
                      else if anime.newest_release_date
                        | • #{anime.newest_release_date}
                      else if anime.status === 'Completed'
                        | • Complete
    else
      div(class="text-center py-16")
        h2(class="text-2xl font-bold mb-4") Konten Tidak Ditemukan
        p(class="text-gray-600 dark:text-gray-400") Maaf, tidak ada anime yang bisa ditampilkan saat ini. Silakan coba lagi nanti.

block scripts
  style.
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  script.
    document.addEventListener('DOMContentLoaded', () => {
      const chipsContainer = document.getElementById('genre-chips-container');
      const animeGrid = document.getElementById('anime-grid');
      const animeCards = animeGrid ? Array.from(animeGrid.children) : [];
      const scrollLeftBtn = document.getElementById('scroll-left');
      const scrollRightBtn = document.getElementById('scroll-right');

      // Chip Filtering Logic
      chipsContainer?.addEventListener('click', (e) => {
        const chip = e.target.closest('.genre-chip');
        if (!chip) return;

        // Update active chip style
        chipsContainer.querySelector('.active-chip').classList.remove('active-chip', 'bg-yt-light-text', 'text-yt-white', 'dark:bg-yt-dark-text', 'dark:text-yt-black');
        chip.classList.add('active-chip', 'bg-yt-light-text', 'text-yt-white', 'dark:bg-yt-dark-text', 'dark:text-yt-black');
        
        // Remove old hover/inactive styles
        chipsContainer.querySelectorAll('.genre-chip:not(.active-chip)').forEach(c => {
          c.classList.add('bg-yt-light-gray-2', 'dark:bg-yt-dark-gray-1', 'hover:bg-gray-300', 'dark:hover:bg-yt-dark-gray-2');
          c.classList.remove('bg-yt-light-text', 'text-yt-white', 'dark:bg-yt-dark-text', 'dark:text-yt-black');
        });
        chip.classList.remove('bg-yt-light-gray-2', 'dark:bg-yt-dark-gray-1');

        const selectedGenre = chip.dataset.genreSlug;

        animeCards.forEach(card => {
          if (selectedGenre === 'all') {
            card.style.display = 'block';
          } else {
            const cardGenres = JSON.parse(card.dataset.genres || '[]');
            if (cardGenres.includes(selectedGenre)) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          }
        });
      });

      // Scroller Logic
      const checkScroll = () => {
        if (!chipsContainer) return;
        const maxScrollLeft = chipsContainer.scrollWidth - chipsContainer.clientWidth;
        scrollLeftBtn.style.display = chipsContainer.scrollLeft > 0 ? 'block' : 'none';
        scrollRightBtn.style.display = chipsContainer.scrollLeft < maxScrollLeft - 1 ? 'block' : 'none';
      };

      scrollLeftBtn?.addEventListener('click', () => {
        chipsContainer.scrollBy({ left: -200, behavior: 'smooth' });
      });

      scrollRightBtn?.addEventListener('click', () => {
        chipsContainer.scrollBy({ left: 200, behavior: 'smooth' });
      });
      
      chipsContainer?.addEventListener('scroll', checkScroll);
      window.addEventListener('resize', checkScroll);
      checkScroll(); // Initial check
    });

